<!DOCTYPE html>
<html>
<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" > 
    	 <title>好友答题赢赠课</title>
    	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js" ></script>
    	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    	<link rel="stylesheet" href="http://activity.china-dt.com/activity/resource/double12/css/weui.css">
		<style>
        html{
            height: 100%;
        }
        body{
            height: 100%;
            background: url("http://activity.china-dt.com/activity/resource/double12/image/bg.png") no-repeat bottom;
            background-size: contain;
        }
        a{
            text-decoration: none;
        }
        #progress{
            width: 43px;
            height: 20px;
            border-radius: 10px;
            background-color: #F3FAF2;
            color: #5CB851;
            margin: 25px auto;
            text-align: center;
        }
        #title{
            font-size: 17px;
            color: #313131;
        }
        #title img{
            margin-top: 15px;
            width: 100px;
            display: block;
        }
        #answers ul li{
            /* height: 43px; */
            background: #f1f1f1;
            border-radius: 5px;
            color: #313131;
            font-size: 14px;
        }
        #answers ul li.optionRight{
            background: #5CB851;
            color: #fff;
        }
        #answers ul li.optionError{
            background: #EB6100;
            color: #fff;
        }
        #tips{
            font-size: 12px;
            color: #a0a0a0;
        }
        #jump{
            display: none;
            font-size: 14px;
            color: #666;
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            margin: 0 -15px;
        }
        .weui-cell{
            justify-content: space-between;
        }
        .weui-cell img.right{
            width: 19px;
            height: 14px;
        }
        .weui-cell img.wrong{
            width: 16px;
            height: 16px;
        }
        #options{
            margin-bottom: 15px;
        }
    </style>
</head>
<body ontouchstart>
<div class="container">
    <div id="progress">
        <span id="current"></span>/5
    </div>
    <div id="title">

    </div>
    <div id="answers">
        <ul id="options">
        </ul>
    </div>
    <div id="tips">
        点击选项及选中该答案哦
    </div>
    <div id="jump"><span id="time"></span>秒后自动跳转到下一题</div>
    <script>
        var num = 0;
        var questionCount = 0;
        var error = [];
        var question = [
            {
                title: "第一代iPhone是谁来设计的？",
                answer: [{index:"A",answer:"罗斯福"},{index:"B",answer:"乔布斯"},{index:"C",answer:"林肯"},{index:"D",answer:"库克"}],
                correct: 1,
                tips: "第一代iPhone是乔布斯设计的",
                pic:'https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1788562038,3472846301&fm=27&gp=0.jpg'
            },
            {
                title: "6+3=？",
                answer: [{index:"A",answer:7},{index:"B",answer:9},{index:"C",answer:6},{index:"D",answer:2}],
                correct: 1,
                tips: "6+3=9",
                pic:''
            }
        ];



        var paper;
        var explain;
        var totalScore = 0;

        function circleAnswer(num) {
            $('#current').html(num+1)
            $('#options').html('');

            //var img = question[num].pic ? '<img src="'+question[num].pic+' class="pic">' : '';

            $('#title').html(paper.questions[num].ibquestion.qcontent);
            for(var i=0; i<paper.questions[num].options.length; i++){
                $('#options').append(' <li class="weui-cells option" data-id='+paper.questions[num].options[i].optionId+' data-value='+paper.questions[num].options[i].isAnswer+'>\n' +
                '<div class="weui-cell">\n' +
                //paper.questions[num].options[i].index + ' ' +
                paper.questions[num].options[i].ocontent +  ' \n' +
                '</div>\n' +
                '</li>')

                if("0" == paper.questions[num].options[i].isAnswer) {
                	explain = paper.questions[num].options[i].oexplain;
                }

            }
            var right;

            $(".option").on("click", function () {
            	var time = 1;
            	var score = 0;
                var $option = $(this);
                if ($option.data("value") == "0") {
                    $option.addClass("optionRight");
                    $option.find('.weui-cell').append("<img class='right' src='${path}/resource/double12/image/right.png'>");
                    tips = "答对了 ";// + explain;
                    right=0;
                    time = 1;
                    score = paper.questions[num].ibquestion.qscore;
                    debugger;
                    totalScore += score;
                } else {
                    $option.addClass("optionError");
                    $option.find('.weui-cell').append("<img class='wrong' src='${path}/resource/double12/image/wrong.png'>");
                    tips = "答错了 " + explain;
                    right=1;
                    time = 3;
                    error.push(num)
                }
                $("#tips").html(tips);
                $(".option").off("click");



                var resultItme = {userId:'${openId}',score:score,paperId:paper.ibpaper.paperId,questionId:paper.questions[num].ibquestion.questionId,optionIds:$option.data("id"),isRight:right,groupId:'${groupId}'};
                submitSingleResult(resultItme);

                //rList.push(resultItme);

                num++;
                if(num==questionCount){
                	debugger;
                    localStorage.score = error.join();
                    var actassistancerecord =
                    {userId:'${userId}',packageName:'${packageName}',paperId:paper.ibpaper.paperId,openId:'${openId}',score:totalScore,groupId:'${groupId}'};

                    setTimeout(saveActassistance(actassistancerecord),2000);
                    //setTimeout(submitResult, 3);
                    //window.location.href = "${path}/service/activity/double12/score/paperId";
                    return false
                }


                var interval = setInterval(function () {
                    $("#jump").show()
                    $("#time").html(time);
                    if(time==0){
                        clearInterval(interval)
                        $("#jump").hide();
                        $("#tips").html("点击选项及选中该答案哦")
                        circleAnswer(num);
                    }else{
                        time--
                    }
                },1000)
            });
        }

        //circleAnswer(num);
        var rList = [];
        function submitResult(){
        	$.ajax({
     			url : '${path}/service/activity/double12/resultSubmit?userId='+'${userId}'+"&packageName="+'${packageName}',
     			//data: JSON.stringify({userId:'uid',paperId:'paperid',resultList:rList}),
     			data: JSON.stringify(rList),
     			contentType: "application/json",
     			async : false,
     			dataType : "json",
     			type:"POST",
     			success : function(data) {
     				console.log(data);
     				window.location.href = "${path}/service/activity/double12/score?packageName="+'${packageName}';
     			}
     		});
        }

        function submitSingleResult(singleResult){
        	$.ajax({
     			url : '${path}/service/activity/double12/singleResultSubmit?userId='+'${userId}'+"&packageName="+'${packageName}',
     			//data: JSON.stringify({userId:'uid',paperId:'paperid',resultList:rList}),
     			data: JSON.stringify(singleResult),
     			contentType: "application/json",
     			async : false,
     			dataType : "json",
     			type:"POST",
     			success : function(data) {
     				console.log(data);
     				//window.location.href = "${path}/service/activity/double12/score?packageName="+'${packageName}';
     			}
     		});
        }

        function saveActassistance(actassistancerecord){
        	$.ajax({
     			url : '${path}/service/activity/double12/saveActassistance',
     			//data: JSON.stringify({userId:'uid',paperId:'paperid',resultList:rList}),
     			data: JSON.stringify(actassistancerecord),
     			contentType: "application/json",
     			async : false,
     			dataType : "json",
     			type:"POST",
     			success : function(data) {
     				console.log(data);
     				window.location.href = "${path}/service/activity/double12/score?packageName="+'${packageName}';
     			}
     		});
        }


        $(function(){
        	 $.ajax({
     			url : 'http://activity.china-dt.com/activity/service/activity/double12/getPaper',
     			//data: {storeId:stId,sujbectDate:sDate,openLessonId:'${openLessonId}'},
     			async : false,
     			dataType : "json",
     			type:"GET",
     			success : function(data) {
     				console.log(data);
     				paper = data;
     				questionCount = data.questions.length;
     				circleAnswer(num);
     			}
     		});

        });

    </script>
</div>
</body>
</html>
